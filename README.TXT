-----------------------------------------------------------------------------
  人狼式 〜汝は人狼なりや？式神エディション version 1.3.0 README 2009/07/10
-----------------------------------------------------------------------------

ダウンロードありがとうございます。
人狼式 〜汝は人狼なりや？式神エディション（以下本スクリプト）は、
人狼スクリプト「汝は人狼なりや？のPHP+MySQL移植版(from ふたば) 」のコードを基に
改良・新機能を追加した、PHPで記述された人狼スクリプトです。

汝は人狼なりや？のPHP+MySQL移植版(from ふたば)の開発元はこちらです。
http://f45.aaa.livedoor.jp/~netfilms/

------------------
  パッケージ内容
------------------
本スクリプトのディレクトリ構成は以下のとおりです。
<top>          : 本体コード
├─admin      : 管理用コード
├─css        : 表示用CSSファイル
├─img        : システム画像ファイル
├─include    : インクルードファイル
├─info       : トップ画面に表示するインフォメーション文コード
├─javascript : Javascriptファイル
├─module     : mbstringエミュレータ用ファイル
├─swf        : 音声ファイル
└─user_icon  : アイコン画像ファイル

------------
  動作環境
------------
本スクリプトは、PHP4＋MySQL4.0環境下での動作を想定しています。
MySQL以外のRDBS環境を用いる場合、MySQL用クエリ関数を書き直す必要があります。

------------
  設置方法
------------
1. MySQLサーバ内に専用データベースとアカウントを作成
   文字コード、照合順序はujis_japanese_ciを使用すること
2. include/setting.phpを編集し、データベースサーバやユーザ名、パスワードを設定
3. パッケージをサーバにアップロード（コード無変換、またはバイナリモード）
4. サーバ上のuser_icon/ディレクトリに書き込み属性を付与
5. admin/ディレクトリにアクセス制限を設定
6. 初期セットアップ作業（自動）のためにadmin/setup.phpにアクセス
7. index.phpにアクセスし、動作を確認

----------------------------
  管理用スクリプトについて
----------------------------
本スクリプトで管理用のスクリプトは以下の通りです。
全てadmin/ディレクトリ内に存在します。
  setup.php       : 初期設定を行うスクリプト。
                    新しくサーバに設置した際に、初めに実行すること。
  room_delete.php : 稼働中の村を削除するためのスクリプト。
                    include/setting.php中の$DEBUG_MODEがtrueの時のみ有効

room_delete.phpについては直接呼び出すものではなく、稼働中の村一覧に表示される
削除用リンクから呼び出されるものです。
ただし、admin/ディレクトリにアクセス制限をかけていない場合、
かつ$DEBUG_MODEがtrueの時には直接アドレス入力することで、
稼働中の村の削除が誰にでも可能となります。
そのため、通常稼動時には$DEBUG_MODEをfalseに設定しておくようにしてください。
デフォルトではfalseに設定されています。

------------------------
  設定ファイルについて
------------------------
本スクリプトの設定ファイルは以下の通りです。
全てinclude/ディレクトリ内に存在します。
  setting.php       : 本スクリプトをサーバ上で動作させるための設定ファイル
  config.php        : 配役、制限時間など、ゲームパラメータの設定ファイル
  system_class.php  : 本スクリプト中で使用される画像ファイルのパス設定ファイル
  message_class.php : ゲーム中で表示されるシステムメッセージの設定ファイル
  version.php       : トップページで表示されるバージョン情報の設定ファイル

このうち、必ず設定が必要になるのはsetting.phpのみです。
他のファイルについては必要に応じて変更してください。
詳細は各ファイルのコメントを参照してください。

----------------
  既知の不具合
----------------
現在、以下の不具合が発生する可能性があります。
これらの不具合は、サーバの状態や負荷の度合いによるものとみられています。

・投票完了したのに突然死する場合がある
　投票完了したにも関わらず、突然死処理が行われる場合が報告されております。
　原因は不明です。対策として、早め早めの投票を呼びかけてください。

・再投票時の投票結果表示が一部しか表示されない
　MySQLサーバのロック機構が何らかの原因で効いていない現象です。
　サーバ依存の問題のようです。頻繁に発生するようであれば、MySQLを更新するか、
　サーバを別のものに変更することを試みてください。

・投票時に大量突然死が発生する場合がある
　投票処理中に突然死処理が何らかの原因で呼び出されたことによる不具合です。
　現在のバージョンでは発生は確認されておりません。

------------
  管理TIPS
------------
・過去ログがDBにたまってくると、サーバの動作が重くなる場合があります。
その場合、過去ログをHTML形式で保存した上でDBから村データの削除を行ってください。
X番地村のデータを消す場合はroom, system_message, talk, user_entry各テーブル中の
room_no = Xに該当するレコードを削除してください。

・登録されたアイコンを何らかの理由で削除する場合は、
user_iconテーブル中の該当レコード、user_icon/ディレクトリ内の該当アイコン画像を
削除してください。
ただし、該当アイコンが過去ログで使用されている場合は、データベースから削除せずに
何らかの別のアイコン画像で置き換える方法をとってください。
また、レコード削除後にicon_noの調整を行ってください。

-------
  FAQ
-------

Q. 動いたけど文字化けしてる
A. MySQLサーバの設定、データベースの設定、ブラウザのエンコード、
   どれかがEUC-JP（ujis_japanese_ci）を使用していないない可能性が高いです。
   一度チェックしてみてください。

----------------------
  使用、改変について
----------------------
改変、再配布は自由です。
しかし、植物の背景画像、左上にある文字の入ったタイトル画像は天の欠片さんの素材を使用しています。
この画像をそのまま使う場合は index.php の天の欠片さんへのリンクを削除しないようにお願いします。
http://keppen.web.infoseek.co.jp/
またこの画像の著作権は天の欠片さんの物なので、自分で撮影したとか自分で作ったとか言わないようにしてください。 
version1.2.0以降で追加した画像については、 あずきふぉんとさんのフォントを利用させていただいています。
この画像をそのまま使う場合は index.php のあずきふぉんとさんへのリンクを削除しないようにお願いします。
http://azukifont.mints.ne.jp/
moduleフォルダの中はmbstringエミュレータが入っています。
http://www.matsubarafamily.com/blog/mbemu.php
これはmbstringが使えない環境でも文字コード関連の処理をするためです。
著作権はmbstringの作者さんのものです。
index.php のリンクを削除しないようにお願いします。

--------------------
  サポートについて
--------------------
本スクリプトに関するバグ報告・要望については以下のどこかにお願いいたします。
なお、現在Sourceforgeのページにフォーラムは用意されておりません。
Sourceforgeの方に報告される場合には、チケットを通してお願いいたします。

式神研究同好会（現行スレ）
http://jbbs.livedoor.jp/bbs/read.cgi/netgame/2829/1240771280/

ウミガメ人狼専用掲示板（上記スレが存在しない場合にはこちらから）
http://jbbs.livedoor.jp/netgame/2829/

人狼式 〜汝は人狼なりや？式神エディション（Sourceforgeプロジェクトページ）
http://sourceforge.jp/projects/jinrousiki/

--------------
  クレジット
--------------
enogu
埋めチル
お肉
赤いきつね
乗月
Kei
atari

他、多数のテストプレイヤー、協力していただいた方々

------------
  変更履歴
------------
version 1.3.0:
・複数の同一役職を村に登場させることが可能
　（デフォルト設定では登場しない。編成を管理者が変更した場合のみ登場）
・狐の念話・仲間表示機能を追加
・埋毒者を噛んで巻き込まれる狼の対象決定方法を任意で変更できる機能を追加
　（狼からランダム or 噛んだ狼固定）
・過去ログを逆順で表示できる機能実装
　(デフォルトは設定ファイルで変更可能)
・投票画面のデザイン変更
　（常に参加者全員が表示され、投票できる者だけラジオボタンを付ける方式に変更）
・遺言は昼/夜の切り替えの影響を受けずに保存できるよう変更
・身代わり君の昼／夜の発言をシステムメッセージとして表示できる機能を追加
　（管理者向け機能）
・発言に「」をつけるオプションを追加
　（設定ファイルでON/OFF可能）
・狼・共有者の仲間表示を改善
・引き分け判定処理の改善
・突然死処理の改善
・突然死などの制限時間表示のバグ修正
・Kick 処理が全ての村に影響するバグ修正
・配役テーブルの仕様変更
・トリップに仮対応 (# が含まれていたらエラーを返すだけ)
・ソースコードファイルの整理・分割・最適化
・その他細かい変更点・バグ修正

version 1.2.2:
・HTML出力にCSSを使用するように変更
・アイコンサイズの最大値をサーバ側で制限する機能を追加
・ソースコードの最適化
・ディレクトリの整理

version 1.2.1:
・身代わりが狼、狐、キューピッドになる可能性がある不具合を修正
・愛の矢のシステムメッセージで村人名ではなくユーザ名が表示される不具合を修正
・霊界役職非表示時にもユーザ名が霊話に表示される不具合を修正
・稼働中の村の霊界役職非表示アイコンが表示されない不具合を修正

version 1.2.0:
・新役職追加（キューピッド・恋人）
・希望役職に埋毒者を追加
・霊界役職非表示オプションを追加
・過去ログに村の参加人数を表示するように修正
・4-7人村の配役追加、最低ゲーム開始可能人数を4人に設定
・その他細かい修正

--- ここから「汝は人狼なりや？のPHP+MySQL移植版(from ふたば) 」の変更履歴 ---
version1.1.5 Kickの処理でKickされて空いたユーザNoを切り詰める処理がうまくいってなかったのを修正
version1.1.4 setting.php以外のほぼ全て修正。Kickされた人の発言が消えるのを修正。遺言の表示順が固定されていたのをランダムに修正。
version1.1.3 game_play.php,game_functions.php,game_view.phpで現在の生存者の数を表示するように、また多少の表示修正
version1.1.2 old_log.phpで妖狐の勝利アイコンが表示されないのを修正
version1.1.1 game_view.phpで遺言が出力されないのを修正
version1.1.0 game_functions.phpのLastWordOutput()で global $day_nightが抜けていたのを修正
version1.0.0 配布開始
